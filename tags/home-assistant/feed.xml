<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Home Assistant on 林中阴影</title><link>https://blog.heysh.xyz/tags/home-assistant/</link><description>Recent content in Home Assistant on 林中阴影</description><generator>Hugo -- gohugo.io</generator><language>zh-cn</language><copyright>&amp;copy;贺叶霜，&lt;a href="https://creativecommons.org/licenses/by-sa/4.0/deed.zh">CC BY-SA&lt;/a></copyright><lastBuildDate>Fri, 10 Feb 2023 20:44:06 +0800</lastBuildDate><atom:link href="https://blog.heysh.xyz/tags/home-assistant/feed.xml" rel="self" type="application/rss+xml"/><item><title>装修“智能”家居笔记，其之一</title><link>https://blog.heysh.xyz/2023/02/10/silly-home-notes-1/</link><pubDate>Fri, 10 Feb 2023 20:44:06 +0800</pubDate><guid>https://blog.heysh.xyz/2023/02/10/silly-home-notes-1/</guid><description>&lt;blockquote>
&lt;p>而RK3328的算力与草履虫大约能打成平手。所以，本文中的“智能”指的都是 &lt;em>不用按电钮就能控制™&lt;/em> 级别，当然，如果能够有一点点自动就更好了。&lt;/p>
&lt;/blockquote>
&lt;h2 id="前期的准备">前期的准备&lt;/h2>
&lt;h3 id="考虑一下">考虑一下&lt;/h3>
&lt;p>其实当个mi boy也不错——全屋小米设备是智能家居方案里面最不坏的选择，做完就可以成为合格的家居up主了&lt;sup id="fnref:1">&lt;a href="#fn:1" class="footnote-ref" role="doc-noteref">1&lt;/a>&lt;/sup>。不过，如果不想被锁定在米系势力范围内，可以尝试一下Home Assistant，尝试成本也不高：几十块钱的魔百盒或者玩客云，或者直接虚拟机都可以。另外，最好能有一个简单的设备来控制，我觉得带红外遥控的小爱音箱 Pro就挺好的。&lt;/p>
&lt;h3 id="装修时">装修时&lt;/h3>
&lt;p>当然是老生常谈的那些：在开关里面留零线、不要做双控（贵）、多做网线口、窗帘盒旁边做插座之类的，剩下的事情只能等到装完以后再后悔了。&lt;/p>
&lt;p>就我来说，我比较后悔没有给拖地机器人留上下水的位置，没有把净水器的纯水管引到客厅，也没有留两个给摄像头和人体存在传感器的插座。&lt;/p>
&lt;h2 id="新手的采购清单">新手的采购清单&lt;/h2>
&lt;p>最好能够遵循 &lt;em>Graceful degradation&lt;/em> 原则：保证有东西坏掉的时候至少还是个mi boy，然后就可以把所有问题推到米家服务器身上了。另一方面，如果要在熟练后彻底摆脱米家的控制，需要寻找那些离线仍然可以通过HA控制的设备，也就是说，最好不要选择米家&lt;del>臭名昭著的&lt;/del>最新的BLE Mesh系列。那么，在2022年，我的选择是大量的Zigbee设备、少量的Wifi设备和更少的蓝牙设备。Nothing Matter.&lt;/p>
&lt;details>
&lt;summary>
&lt;h4 class="inline">
下面是米系智能设备的列表，截至2022年。盛惠5527元。
&lt;/h4>
&lt;/summary>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>设备&lt;/th>
&lt;th>数量&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>墙壁开关E1（零火双键）&lt;/td>
&lt;td>10&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Aqara双色温LED灯泡T1&lt;/td>
&lt;td>6&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Aqara智能墙壁插座Zigbee&lt;/td>
&lt;td>1&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Aqara水浸传感器&lt;/td>
&lt;td>2&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Aqara人体传感器&lt;/td>
&lt;td>2&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Aqara门窗传感器&lt;/td>
&lt;td>1&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Aqara温湿度传感器&lt;/td>
&lt;td>1&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>yeelight m3筒灯（BLE）&lt;/td>
&lt;td>1&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>米家第三方壁灯（BLE）&lt;/td>
&lt;td>2&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>米家客厅吸顶灯&lt;/td>
&lt;td>1&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>米家卧室吸顶灯450&lt;/td>
&lt;td>1&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>米家卧室吸顶灯350&lt;/td>
&lt;td>2&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>杜亚M2米家款电机（Aqara的买不起）&lt;/td>
&lt;td>3&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>门锁1s（BLE）&lt;/td>
&lt;td>1&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>小米多模网关&lt;/td>
&lt;td>1&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;/details>
&lt;p>Aqara在闲鱼买会显得不那么冤大头，杜亚牌电机也比杜亚代工的Aqara电机便宜很多。家电方面，美的和其副牌（小天鹅、华凌、colmo之类）一般自带网络功能，通过插件&lt;a href="https://github.com/georgezhao2010/midea_ac_lan">midea_ac_lan&lt;/a>和HA配合的很不错。&lt;/p>
&lt;figure>&lt;img src="midea.png"
alt="美的营销号矩阵"/>&lt;figcaption>
&lt;p>美的营销号矩阵&lt;/p>
&lt;/figcaption>
&lt;/figure>
&lt;p>对了，还需要一台能够24小时开机的设备，比如NAS啊、矿渣啊什么的。&lt;/p>
&lt;h2 id="安装和设置">安装和设置&lt;/h2>
&lt;p>安装HA的部分在此不再赘述。通过米家APP配置以上的所有设备，并使用&lt;a href="https://github.com/al-one/hass-xiaomi-miot">hass-xiaomi-miot&lt;/a>和&lt;a href="https://github.com/AlexxIT/XiaomiGateway3#supported-firmwares">XiaomiGateway3&lt;/a>导入HA。这里需要注意的是，&lt;code>hass-xiaomi-miot&lt;/code>集成只能对WiFi设备进行本地控制，对Zigbee和BLE设备&lt;a href="https://github.com/al-one/hass-xiaomi-miot/issues/100#issuecomment-855183156">需要通过米家服务器&lt;/a>。所以最好由&lt;code>gateway3&lt;/code>控制这些设备，在&lt;code>hass-xiaomi-miot&lt;/code>集成中禁用。&lt;/p>
&lt;p>考虑到安装非智能灯的可能性，我采用了&lt;code>智能开关+智能灯&lt;/code>的组合，这种组合更为保守，&lt;code>凌动开关+支持凌动的智能灯&lt;/code>效果大概会更好。在把所有智能灯配置完成后，在米家APP上把链接智能灯的开关&lt;code>转为无线开关&lt;/code>，然后在HA中设置自动化，感觉比米家自动化的反应更灵敏一些。不过，为了防止在HA断掉时挨骂，我也在米家APP上添加了备份：在同时按下开关左右键的时候关闭智能灯。&lt;/p>
&lt;figure>&lt;img src="double-auto.jpg"
alt="HA和米家设置自动化"/>&lt;figcaption>
&lt;p>HA和米家设置自动化&lt;/p>
&lt;/figcaption>
&lt;/figure>
&lt;p>这样，在关闭智能灯的时候不会断电，可以实现灯光缓灭、&lt;a href="https://github.com/basnijholt/adaptive-lighting">自适应照明&lt;/a>等高级功能。&lt;/p>
&lt;p>窗帘的部分就更简单了，只要定时开关就行。通过HA的手机APP，可以将&lt;a href="https://companion.home-assistant.io/docs/core/sensors/#next-alarm-sensor">下一个闹钟时间&lt;/a>导入自动化，实现闹铃响起时打开窗帘。&lt;/p>
&lt;h2 id="附加题部分">附加题部分&lt;/h2>
&lt;p>在基本框架（aka灯和窗帘）搭好之后，就可以放飞自我搞一些新花样。&lt;/p>
&lt;h3 id="智能面板">智能面板&lt;/h3>
&lt;p>&lt;a href="https://detail.1688.com/offer/662976153559.html?spm=a26352.13672862.offerlist.49.3a512910uzdgfQ">Sonoff NSPanel&lt;/a>应该是最便宜的智能面板了，而且可以刷第三方固件&lt;a href="https://github.com/joBr99/nspanel-lovelace-ui">lovelace-ui&lt;/a>或&lt;a href="https://github.com/Blackymas/NSPanel_HA_Blueprint">NSPanel_HA_Blueprint&lt;/a>，可玩性非常高。&lt;/p>
&lt;p>&lt;img src="nspanel-rl.png" alt="NSPanel Lovelace UI">&lt;/p>
&lt;p>如果需要更大的屏幕，甚至可以在仓库里找一些淘汰的设备，比如说还能亮的山寨平板、二手安卓手机、闲鱼低价带屏开发板之类。通过&lt;a href="https://wallpanel.xyz/">WallPanel&lt;/a>和&lt;a href="https://github.com/NemesisRE/kiosk-mode">HA的kiosk-mode插件&lt;/a>，可以让这些设备直接成为HA的前端显示&lt;sup id="fnref:2">&lt;a href="#fn:2" class="footnote-ref" role="doc-noteref">2&lt;/a>&lt;/sup>。&lt;/p>
&lt;figure>&lt;img src="panel.jpg"
alt="一个二手安卓触摸屏"/>&lt;figcaption>
&lt;p>一个二手安卓触摸屏&lt;/p>
&lt;/figcaption>
&lt;/figure>
&lt;p>作为一个直男，还有一件事情要嘱咐：不要搞得太丑了，正常人不会喜欢满墙飞线的，至少拿个相框遮一下。这部分我也不会，所以我从网上找了一张图。&lt;/p>
&lt;p>&lt;img src="frame.webp" alt="reddit：surface_pro_3_wall_tablet_install，这张图也挺丑的">&lt;/p>
&lt;h3 id="esphome">ESPHome&lt;/h3>
&lt;p>传感器是从遥控家居走向智能的关键一步，在需要更多种类的传感器时，&lt;a href="https://esphome.io/">ESPHome&lt;/a>能够派上用场。只需要一块ESP32，加上AHT20就是温湿度计，&lt;del>加上SGP30是TVOC检测仪&lt;/del>&lt;sup id="fnref:3">&lt;a href="#fn:3" class="footnote-ref" role="doc-noteref">3&lt;/a>&lt;/sup>，加上PZEM-004T就是智能电流表，加上LD2410就是人体感应雷达，而且都可以与HA控制的所有设备联动。唯一的问题是，ESP32系列一般是通过Wifi联网，可能会对路由器造成一点点压力，如果是一万块钱的高级路由器K3就无所谓了。&lt;/p>
&lt;p>另外，如果完全不想和小米打交道，易微联、涂鸦或小燕科技的设备也可以试试。没准过几&lt;del>天&lt;/del>年Matter设备也会上市？&lt;/p>
&lt;hr>
&lt;p>那么关于智能家居的第一部分在此告一段落，之后会记录一些更为个性化的部分，而今天又是一个思念192.168.1.1的日子。虽然心已随着VPN回到家乡，但身体仍在公网上漂泊。&lt;/p>
&lt;h2 id="参考">参考&lt;/h2>
&lt;ul>
&lt;li>&lt;a href="https://bbs.hassbian.com/thread-16261-1-1.html">HA智能硬件采购避坑指要&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://post.m.smzdm.com/p/a85gplo7/?from=other&amp;amp;invite_code=zdm8xwesxhinv&amp;amp;send_by=6416413937&amp;amp;utm_source=pocket_mylist&amp;amp;zdm_ss=Android_6416413937_">论如何打造一个科技爱好者/直男审美的家——（五）智能家居&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://zhuanlan.zhihu.com/p/87595668">智能家居防悔全指南(小米/绿米)&lt;/a>&lt;/li>
&lt;/ul>
&lt;div class="footnotes" role="doc-endnotes">
&lt;hr>
&lt;ol>
&lt;li id="fn:1">
&lt;p>那么你可以直接跳过这篇文章，不会有什么损失。&amp;#160;&lt;a href="#fnref:1" class="footnote-backref" role="doc-backlink">&amp;#x21a9;&amp;#xfe0e;&lt;/a>&lt;/p>
&lt;/li>
&lt;li id="fn:2">
&lt;p>HA前端对浏览器版本有一定要求。如果设备过于古老的话，可能需要手动更新Webview，见&lt;a href="https://blakadder.com/android-panel-webview/">此处&lt;/a>。&amp;#160;&lt;a href="#fnref:2" class="footnote-backref" role="doc-backlink">&amp;#x21a9;&amp;#xfe0e;&lt;/a>&lt;/p>
&lt;/li>
&lt;li id="fn:3">
&lt;p>这个不要用，长期开机读数会暴涨。&amp;#160;&lt;a href="#fnref:3" class="footnote-backref" role="doc-backlink">&amp;#x21a9;&amp;#xfe0e;&lt;/a>&lt;/p>
&lt;/li>
&lt;/ol>
&lt;/div></description></item></channel></rss>